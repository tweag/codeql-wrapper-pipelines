version: 2.1

jobs:
  codeql-analysis:
    docker:
      - image: cimg/python:3.13 # Use a suitable image for your Python & Linux environment

    steps:
      - checkout

      - run:
          name: Install Python (if needed)
          command: |
            chmod +x ./install_python.sh
            ./install_python.sh

      - run:
          name: Install CodeQL Wrapper
          command: |
            pip install -i https://test.pypi.org/simple/ codeql-wrapper
            codeql-wrapper --version

      - run:
          name: Run CodeQL Analysis
          #environment:
          #  GITHUB_TOKEN: ${PAT} # Set PAT as environment variable in CircleCI project settings
          command: |
            export GITHUB_TOKEN=${PAT} # Set PAT as environment variable in CircleCI project settings
            codeql-wrapper --verbose analyze ./monorepo --monorepo --upload-sarif

workflows:
  version: 2
  codeql-workflow:
    jobs:
      - codeql-analysis
